---
title: Microsoft Teams Authentifizierungsfluss für Bots
description: Beschreibt Microsoft Teams Authentifizierungsfluss in Bots
keywords: Teams-Authentifizierungsfluss-Bots
localization_priority: Normal
ms.topic: overview
ms.openlocfilehash: fdce053ce837bb9a244712a63515194d05adb3a8
ms.sourcegitcommit: e327c9766dfa05abb468cdc71319e3cba7c6c79f
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 07/14/2021
ms.locfileid: "53428702"
---
# <a name="authentication-flow-for-bots-in-microsoft-teams"></a><span data-ttu-id="e86ff-104">Authentifizierungsfluss für Bots in Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="e86ff-104">Authentication flow for bots in Microsoft Teams</span></span>

<span data-ttu-id="e86ff-105">OAuth 2.0 ist ein offener Standard für Authentifizierung und Autorisierung, der von Azure Active Directory (Azure AD) und vielen anderen Identitätsanbietern verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="e86ff-105">OAuth 2.0 is an open standard for authentication and authorization used by Azure Active Directory (Azure AD) and many other identity providers.</span></span> <span data-ttu-id="e86ff-106">Ein grundlegendes Verständnis von OAuth 2.0 ist eine Voraussetzung für die Arbeit mit der Authentifizierung in Teams. [Hier ist eine gute Übersicht,](https://aaronparecki.com/oauth-2-simplified/) die einfacher zu befolgen ist als die [formale Spezifikation.](https://oauth.net/2/)</span><span class="sxs-lookup"><span data-stu-id="e86ff-106">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="e86ff-107">Der Authentifizierungsfluss für Registerkarten und Bots ist ein wenig anders – Registerkarten sind Websites sehr ähnlich, sodass sie OAuth 2.0 direkt verwenden können, während Bots einige Dinge nicht anders ausführen müssen und müssen, aber die Kernkonzepte sind identisch.</span><span class="sxs-lookup"><span data-stu-id="e86ff-107">Authentication flow for tabs and bots is a little different — tabs are very similar to websites so they can use OAuth 2.0 directly, while bots aren't and must do a few things differently — but the core concepts are identical.</span></span>

<span data-ttu-id="e86ff-108">Ein Beispiel, das den Authentifizierungsfluss für Bots mit Node.js und dem [OAuth 2.0-Autorisierungscodegenehmigungstyp](https://oauth.net/2/grant-types/authorization-code/)veranschaulicht, finden Sie im GitHub Repository Microsoft Teams [Authentication-Beispiel.](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-auth/nodejs)</span><span class="sxs-lookup"><span data-stu-id="e86ff-108">See the GitHub repo [Microsoft Teams Authentication Sample](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-auth/nodejs) for an example that demonstrates authentication flow for bots using Node.js and the [OAuth 2.0 authorization code grant type](https://oauth.net/2/grant-types/authorization-code/).</span></span>

![Diagramm der Bot-Authentifizierungssequenz](../../../assets/images/authentication/bot_auth_sequence_diagram.png)

1. <span data-ttu-id="e86ff-110">Der Benutzer sendet eine Nachricht an den Bot.</span><span class="sxs-lookup"><span data-stu-id="e86ff-110">The user sends a message to the bot.</span></span>
2. <span data-ttu-id="e86ff-111">Der Bot bestimmt, ob sich der Benutzer anmelden muss.</span><span class="sxs-lookup"><span data-stu-id="e86ff-111">The bot determines if the user needs to sign in.</span></span>
   <span data-ttu-id="e86ff-112">In diesem Beispiel speichert der Bot das Zugriffstoken in seinem Benutzerdatenspeicher.</span><span class="sxs-lookup"><span data-stu-id="e86ff-112">In this example, the bot stores the access token in its user data store.</span></span> <span data-ttu-id="e86ff-113">Der Benutzer wird aufgefordert, sich anzumelden, wenn er kein überprüftes Token für den ausgewählten Identitätsanbieter hat.</span><span class="sxs-lookup"><span data-stu-id="e86ff-113">It asks the user to sign in if it doesn't have a validated token for the selected identity provider.</span></span> <span data-ttu-id="e86ff-114">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/utils/AuthenticationUtils.ts#L58-L76))</span><span class="sxs-lookup"><span data-stu-id="e86ff-114">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/utils/AuthenticationUtils.ts#L58-L76))</span></span>
3. <span data-ttu-id="e86ff-115">Der Bot erstellt die URL zur Startseite des Authentifizierungsflusses und sendet eine Karte mit einer Aktion an den `signin` Benutzer.</span><span class="sxs-lookup"><span data-stu-id="e86ff-115">The bot constructs the URL to the start page of the authentication flow, and sends a card to the user with a `signin` action.</span></span> <span data-ttu-id="e86ff-116">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L160-L190))</span><span class="sxs-lookup"><span data-stu-id="e86ff-116">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L160-L190))</span></span></br>
    <span data-ttu-id="e86ff-117">Wie andere Anwendungsauthentifizierungsflüsse in Teams muss sich die Startseite in einer Domäne befinden, die sich in Ihrer `validDomains` Liste befindet, und in derselben Domäne wie die Umleitungsseite nach der Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="e86ff-117">Like other application auth flows in Teams, the start page must be in a domain that's on your `validDomains` list, and in the same domain as the post-login redirect page.</span></span>
    > [!IMPORTANT] 
    > <span data-ttu-id="e86ff-118">Der OAuth 2.0-Autorisierungscode-Genehmigungsfluss ruft einen `state` Parameter in der Authentifizierungsanforderung auf, der ein eindeutiges Sitzungstoken enthält, um einen [websiteübergreifenden Anforderungs-Forgery-Angriff](https://en.wikipedia.org/wiki/Cross-site_request_forgery)zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="e86ff-118">The OAuth 2.0 authorization code grant flow calls for a `state` parameter in the authentication request which contains a unique session token to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="e86ff-119">Im Beispiel wird eine zufällig generierte GUID verwendet.</span><span class="sxs-lookup"><span data-stu-id="e86ff-119">The example uses a randomly-generated GUID.</span></span>
4. <span data-ttu-id="e86ff-120">Wenn der Benutzer die *Anmeldeschaltfläche* auswählt, öffnet Teams ein Popupfenster und navigiert zur Startseite.</span><span class="sxs-lookup"><span data-stu-id="e86ff-120">When the user selects the *signin* button, Teams opens a popup window and navigates to the start page.</span></span>
   > [!NOTE]
   > <span data-ttu-id="e86ff-121">Die Größe des Popupfensters kann über Die Abfragezeichenfolgenparameter für Breite und Höhe in der URL gesteuert werden.</span><span class="sxs-lookup"><span data-stu-id="e86ff-121">The size of the pop-up window can be controlled through width and height query string parameters in the URL.</span></span> <span data-ttu-id="e86ff-122">Wenn Sie beispielsweise width=600 und height=600 hinzufügen, beträgt die Größe des Popupfensters 600 x 600 Pixel.</span><span class="sxs-lookup"><span data-stu-id="e86ff-122">For example, if you add width=600 and height=600, the size of the pop-up window is 600x600 pixels.</span></span> <span data-ttu-id="e86ff-123">Die tatsächliche Größe des Popupfensters ist als Prozentsatz der Teams Hauptfenstergröße begrenzt.</span><span class="sxs-lookup"><span data-stu-id="e86ff-123">The actual size of the pop-up window is capped as a percentage of the Teams main window size.</span></span> <span data-ttu-id="e86ff-124">Wenn das Teams Fenster klein ist, ist das Popupfenster kleiner als die angegebenen Abmessungen.</span><span class="sxs-lookup"><span data-stu-id="e86ff-124">If the Teams window is small, the pop-up window is smaller than the specified dimensions.</span></span>

5. <span data-ttu-id="e86ff-125">Die Startseite leitet den Benutzer an den Endpunkt des Identitätsanbieters `authorize` weiter.</span><span class="sxs-lookup"><span data-stu-id="e86ff-125">The start page redirects the user to the identity provider's `authorize` endpoint.</span></span> <span data-ttu-id="e86ff-126">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/public/html/auth-start.html#L51-L56))</span><span class="sxs-lookup"><span data-stu-id="e86ff-126">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/public/html/auth-start.html#L51-L56))</span></span>
6. <span data-ttu-id="e86ff-127">Auf der Website des Anbieters meldet sich der Benutzer an und gewährt Zugriff auf den Bot.</span><span class="sxs-lookup"><span data-stu-id="e86ff-127">On the provider's site, the user signs in and grants access to the bot.</span></span>
7. <span data-ttu-id="e86ff-128">Der Anbieter führt den Benutzer mit einem Autorisierungscode zur OAuth-Umleitungsseite des Bots.</span><span class="sxs-lookup"><span data-stu-id="e86ff-128">The provider takes the user to the bot's OAuth redirect page with an authorization code.</span></span>
8. <span data-ttu-id="e86ff-129">Der Bot löst den Autorisierungscode für ein Zugriffstoken ein und ordnet das Token **vorläufig** dem Benutzer zu, der den Anmeldefluss initiiert hat.</span><span class="sxs-lookup"><span data-stu-id="e86ff-129">The bot redeems the authorization code for an access token, and **provisionally** associates the token with the user that initiated the sign-in flow.</span></span> <span data-ttu-id="e86ff-130">Nachfolgend wird dies als *vorläufiges Token bezeichnet.*</span><span class="sxs-lookup"><span data-stu-id="e86ff-130">Below, we call this a *provisional token*.</span></span>
    * <span data-ttu-id="e86ff-131">In dem Beispiel ordnet der Bot den Wert des Parameters der ID des Benutzers zu, `state` der den Anmeldevorgang initiiert hat, damit er ihn später mit dem vom Identitätsanbieter zurückgegebenen Wert abgleichen `state` kann.</span><span class="sxs-lookup"><span data-stu-id="e86ff-131">In the example, the bot associates the value of the `state` parameter with the ID of the user that initiated the sign-in process so it can later match it with the `state` value returned by the identity provider.</span></span> <span data-ttu-id="e86ff-132">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L70-L99))</span><span class="sxs-lookup"><span data-stu-id="e86ff-132">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L70-L99))</span></span>
      > [!IMPORTANT] 
      > <span data-ttu-id="e86ff-133">Der Bot speichert das Token, das er vom Identitätsanbieter erhält, und ordnet es einem bestimmten Benutzer zu, ist jedoch als "Ausstehende Überprüfung" gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="e86ff-133">The bot stores the token it receives from the identity provider and associates it with a specific user, but it is marked as "pending validation".</span></span> 
    * <span data-ttu-id="e86ff-134">Das vorläufige Token kann ohne weitere Überprüfung nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e86ff-134">The provisional token can't be used without further validation.</span></span>
      1. <span data-ttu-id="e86ff-135">**Überprüfen, was vom Identitätsanbieter empfangen wird.**</span><span class="sxs-lookup"><span data-stu-id="e86ff-135">**Validate what's received from the identity provider.**</span></span> <span data-ttu-id="e86ff-136">Der Wert des Parameters muss gegenüber dem `state` bestätigt werden, was zuvor gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="e86ff-136">The value of the `state` parameter must be confirmed against what was saved earlier.</span></span> 
      1. <span data-ttu-id="e86ff-137">**Überprüfen Sie, was von Teams empfangen wird.**</span><span class="sxs-lookup"><span data-stu-id="e86ff-137">**Validate what's received from Teams.**</span></span> <span data-ttu-id="e86ff-138">Es wird eine [zweistufige Authentifizierungsüberprüfung](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) durchgeführt, um sicherzustellen, dass der Benutzer, der den Bot mit dem Identitätsanbieter autorisiert hat, derselbe Benutzer ist, der mit dem Bot chatscht.</span><span class="sxs-lookup"><span data-stu-id="e86ff-138">A [two-step authentication](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) validation is performed to ensure that the user who authorized the bot with the identity provider is the same user who is chatting with the bot.</span></span> <span data-ttu-id="e86ff-139">Dies schützt vor [Man-in-the-Middle-](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) und [Phishing-Angriffen.](https://en.wikipedia.org/wiki/Phishing)</span><span class="sxs-lookup"><span data-stu-id="e86ff-139">This guards against [man-in-the-middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) and [phishing](https://en.wikipedia.org/wiki/Phishing) attacks.</span></span> <span data-ttu-id="e86ff-140">Der Bot generiert einen Überprüfungscode und speichert ihn, der dem Benutzer zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="e86ff-140">The bot generates a verification code and stores it, associated with the user.</span></span> <span data-ttu-id="e86ff-141">Der Überprüfungscode wird automatisch von Teams wie unten beschrieben gesendet.</span><span class="sxs-lookup"><span data-stu-id="e86ff-141">The verification code is sent automatically by Teams as described below.</span></span> <span data-ttu-id="e86ff-142">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L100-L113))</span><span class="sxs-lookup"><span data-stu-id="e86ff-142">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L100-L113))</span></span>
9. <span data-ttu-id="e86ff-143">Der OAuth-Rückruf rendert eine Seite, die `notifySuccess("<verification code>")` aufruft.</span><span class="sxs-lookup"><span data-stu-id="e86ff-143">The OAuth callback renders a page that calls `notifySuccess("<verification code>")`.</span></span> <span data-ttu-id="e86ff-144">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/master/src/views/oauth-callback-success.hbs))</span><span class="sxs-lookup"><span data-stu-id="e86ff-144">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/master/src/views/oauth-callback-success.hbs))</span></span>
10. <span data-ttu-id="e86ff-145">Teams schließt das Popupfenster und sendet das `<verification code>` Gesendete `notifySuccess()` an den Bot zurück.</span><span class="sxs-lookup"><span data-stu-id="e86ff-145">Teams closes the pop-up window and sends the `<verification code>` sent to `notifySuccess()` back to the bot.</span></span> <span data-ttu-id="e86ff-146">Der Bot empfängt eine [Aufrufnachricht](/bot-framework/dotnet/bot-builder-dotnet-activities#invoke) mit `name = signin/verifyState` .</span><span class="sxs-lookup"><span data-stu-id="e86ff-146">The bot receives an [invoke](/bot-framework/dotnet/bot-builder-dotnet-activities#invoke) message with `name = signin/verifyState`.</span></span>
11. <span data-ttu-id="e86ff-147">Der Bot überprüft den eingehenden Überprüfungscode anhand des Überprüfungscodes, der mit dem vorläufigen Token des Benutzers gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="e86ff-147">The bot checks the incoming verification code against the verification code stored with the user's provisional token.</span></span> <span data-ttu-id="e86ff-148">([Ansichtscode](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L127-L140))</span><span class="sxs-lookup"><span data-stu-id="e86ff-148">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L127-L140))</span></span>
12. <span data-ttu-id="e86ff-149">Wenn sie übereinstimmen, markiert der Bot das Token als überprüft und einsatzbereit.</span><span class="sxs-lookup"><span data-stu-id="e86ff-149">If they match, the bot marks the token as validated and ready for use.</span></span> <span data-ttu-id="e86ff-150">Andernfalls schlägt der Authentifizierungsfluss fehl, und der Bot löscht das vorläufige Token.</span><span class="sxs-lookup"><span data-stu-id="e86ff-150">Otherwise, the auth flow fails, and the bot deletes the provisional token.</span></span>

    > [!NOTE]
    > <span data-ttu-id="e86ff-151">Wenn Probleme mit der Authentifizierung auf mobilen Geräten auftreten, stellen Sie sicher, dass Ihr JavaScript-SDK auf Version 1.4.1 oder höher aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="e86ff-151">If you experience issues with authentication on mobile, ensure your JavaScript SDK is updated to version 1.4.1 or later.</span></span>

## <a name="code-sample"></a><span data-ttu-id="e86ff-152">Codebeispiel</span><span class="sxs-lookup"><span data-stu-id="e86ff-152">Code sample</span></span>

<span data-ttu-id="e86ff-153">Beispielcode für den Bot-Authentifizierungsprozess:</span><span class="sxs-lookup"><span data-stu-id="e86ff-153">Sample code showing the bot authentication process:</span></span>

| <span data-ttu-id="e86ff-154">**Beispielname**</span><span class="sxs-lookup"><span data-stu-id="e86ff-154">**Sample name**</span></span> | <span data-ttu-id="e86ff-155">**Beschreibung**</span><span class="sxs-lookup"><span data-stu-id="e86ff-155">**Description**</span></span> | <span data-ttu-id="e86ff-156">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="e86ff-156">**Node.js**</span></span> | <span data-ttu-id="e86ff-157">**.NET**</span><span class="sxs-lookup"><span data-stu-id="e86ff-157">**.NET**</span></span> | <span data-ttu-id="e86ff-158">**Python**</span><span class="sxs-lookup"><span data-stu-id="e86ff-158">**Python**</span></span> |
|-----------------|----------------|--------------|----------|-----------|
| <span data-ttu-id="e86ff-159">Teams-Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="e86ff-159">Teams authentication</span></span> | <span data-ttu-id="e86ff-160">In diesem Beispiel wird die Authentifizierung in Microsoft Teams Apps veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="e86ff-160">This sample demonstrates authentication in Microsoft Teams apps.</span></span> | [<span data-ttu-id="e86ff-161">Anzeigen</span><span class="sxs-lookup"><span data-stu-id="e86ff-161">View</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-auth-node) | | |
| <span data-ttu-id="e86ff-162">Bot-Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="e86ff-162">Bot authentication</span></span> | <span data-ttu-id="e86ff-163">In diesem Beispiel wird die Verwendung der Authentifizierung für einen Bot veranschaulicht, der in Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="e86ff-163">This sample demonstrates how to use authentication for a bot running in Microsoft Teams</span></span> | [<span data-ttu-id="e86ff-164">Anzeigen</span><span class="sxs-lookup"><span data-stu-id="e86ff-164">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/javascript_nodejs/46.teams-auth) | [<span data-ttu-id="e86ff-165">Anzeigen</span><span class="sxs-lookup"><span data-stu-id="e86ff-165">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/csharp_dotnetcore/46.teams-auth) | [<span data-ttu-id="e86ff-166">Anzeigen</span><span class="sxs-lookup"><span data-stu-id="e86ff-166">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/46.teams-auth)

## <a name="see-also"></a><span data-ttu-id="e86ff-167">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="e86ff-167">See also</span></span>

[<span data-ttu-id="e86ff-168">Hinzufügen der Authentifizierung zu Ihrem Teams Bot</span><span class="sxs-lookup"><span data-stu-id="e86ff-168">Add authentication to your Teams bot</span></span>](add-authentication.md)
