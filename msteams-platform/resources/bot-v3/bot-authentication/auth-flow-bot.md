---
title: Authentifizierungsablauf für Bots
description: Beschreibung des Authentifizierungs Flusses in Bots
keywords: Bots für Teams-Authentifizierungs Fluss
ms.date: 03/01/2018
ms.openlocfilehash: 5230a94b23f9042d9d7753b52467fba5b2fec89e
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/01/2020
ms.locfileid: "41674576"
---
# <a name="microsoft-teams-authentication-flow-for-bots"></a><span data-ttu-id="9bd4f-104">Microsoft Teams-Authentifizierungs Fluss für Bots</span><span class="sxs-lookup"><span data-stu-id="9bd4f-104">Microsoft Teams authentication flow for bots</span></span>

[!include[v3-to-v4-SDK-pointer](~/includes/v3-to-v4-pointer-bots.md)]

<span data-ttu-id="9bd4f-105">OAuth 2,0 ist ein offener Standard für Authentifizierung und Autorisierung, der von Azure AD und vielen anderen Identitätsanbietern verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-105">OAuth 2.0 is an open standard for authentication and authorization used by Azure AD and many other identity providers.</span></span> <span data-ttu-id="9bd4f-106">Ein grundlegendes Verständnis von OAuth 2,0 ist eine Voraussetzung für die Verwendung von Authentifizierung in Microsoft Teams. [hier finden Sie eine gute Übersicht](https://aaronparecki.com/oauth-2-simplified/) , die einfacher zu befolgen ist als die [formale Spezifikation](https://oauth.net/2/).</span><span class="sxs-lookup"><span data-stu-id="9bd4f-106">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="9bd4f-107">Authentifizierungs Fluss für Registerkarten und Bots sind ein wenig anders, da Registerkarten sehr ähnlich zu Websites sind, damit Sie OAuth 2,0 direkt verwenden können, und Bots sind nicht und müssen ein paar Dinge anders tun, aber die Kernkonzepte sind identisch.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-107">Authentication flow for tabs and bots are a little different because tabs are very similar to websites so they can use OAuth 2.0 directly, and bots are not and must do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="9bd4f-108">Im GitHub Repo [Microsoft Teams-Authentifizierungs Beispiel](https://github.com/OfficeDev/microsoft-teams-sample-auth-node) wird ein Beispiel für den Authentifizierungsablauf für Bots verwendet, die den Knoten mit dem [OAuth 2,0-Autorisierungscode Grant-Typ](https://oauth.net/2/grant-types/authorization-code/)verwenden.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-108">See the GitHub repo [Microsoft Teams Authentication Sample](https://github.com/OfficeDev/microsoft-teams-sample-auth-node) for an example that demonstrates authentication flow for bots using Node using the [OAuth 2.0 authorization code grant type](https://oauth.net/2/grant-types/authorization-code/).</span></span>

![Robot-Authentifizierungs-Sequenzdiagramm](~/assets/images/authentication/bot_auth_sequence_diagram.png)

1. <span data-ttu-id="9bd4f-110">Der Benutzer sendet eine Nachricht an den bot.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-110">The user sends a message to the bot.</span></span>
2. <span data-ttu-id="9bd4f-111">Der bot bestimmt, ob der Benutzer sich anmelden muss.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-111">The bot determines if the user needs to sign in.</span></span>
    * <span data-ttu-id="9bd4f-112">In diesem Beispiel speichert der bot das Zugriffstoken in seinem Benutzerdatenspeicher.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-112">In this example, the bot stores the access token in its user data store.</span></span> <span data-ttu-id="9bd4f-113">Der Benutzer wird aufgefordert, sich anzumelden, wenn er kein validiertes Token für den ausgewählten Identitätsanbieter besitzt.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-113">It asks the user to log in if it doesn't have a validated token for the selected identity provider.</span></span> <span data-ttu-id="9bd4f-114">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/utils/AuthenticationUtils.ts#L58-L76))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-114">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/utils/AuthenticationUtils.ts#L58-L76))</span></span>
3. <span data-ttu-id="9bd4f-115">Der bot konstruiert die URL der Startseite des Authentifizierungs Flusses und sendet eine Karte an den Benutzer mit einer `signin` Aktion.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-115">The bot constructs the URL to the start page of the authentication flow, and sends a card to the user with a `signin` action.</span></span> <span data-ttu-id="9bd4f-116">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L160-L190))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-116">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L160-L190))</span></span>
    * <span data-ttu-id="9bd4f-117">Wie bei anderen Anwendungs Authentifizierungs Abläufen in Microsoft Teams muss sich die Startseite in einer Domäne befinden `validDomains` , die sich in Ihrer Liste befindet, und in derselben Domäne wie die Umleitungsseite nach der Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-117">Like other application auth flows in Teams, the start page must be on a domain that's in your `validDomains` list, and on the same domain as the post-login redirect page.</span></span>
    * <span data-ttu-id="9bd4f-118">**Wichtig**: der OAuth 2,0-Autorisierungscode Grant-Fluss `state` Ruft für einen Parameter in der Authentifizierungsanforderung, die ein eindeutiges Sitzungstoken enthält, um einen [Fälschungs Angriff mit standortübergreifender Anforderung](https://en.wikipedia.org/wiki/Cross-site_request_forgery)zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-118">**IMPORTANT**: The OAuth 2.0 authorization code grant flow calls for a `state` parameter in the authentication request which contains a unique session token to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="9bd4f-119">Im Beispiel wird eine zufällig generierte GUID verwendet.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-119">The example uses a randomly-generated GUID.</span></span>
4. <span data-ttu-id="9bd4f-120">Wenn der Benutzer auf die Schaltfläche " *SignIn* " klickt, öffnet Microsoft Teams ein Popupfenster und navigiert es zur Startseite.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-120">When the user clicks on the *signin* button, Teams opens a popup window and navigates it to the start page.</span></span>
5. <span data-ttu-id="9bd4f-121">Auf der Startseite wird der Benutzer an den `authorize` Endpunkt des Identitätsanbieters umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-121">The start page redirects the user to the identity provider's `authorize` endpoint.</span></span> <span data-ttu-id="9bd4f-122">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/public/html/auth-start.html#L51-L56))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-122">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/public/html/auth-start.html#L51-L56))</span></span>
6. <span data-ttu-id="9bd4f-123">Der Benutzer meldet sich auf der Website des Anbieters an und erteilt Zugriff auf den bot.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-123">On the provider's site, the user signs in and grants access to the bot.</span></span>
7. <span data-ttu-id="9bd4f-124">Der Anbieter führt den Benutzer mit einem Autorisierungscode zur OAuth-Umleitungsseite des bot.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-124">The provider takes the user to the bot's OAuth redirect page, with an authorization code.</span></span>
8. <span data-ttu-id="9bd4f-125">Der bot löst den Autorisierungscode für ein Zugriffstoken aus und ordnet das Token **vorläufig** dem Benutzer zu, der den Anmelde Fluss initiiert hat.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-125">The bot redeems the authorization code for an access token, and **provisionally** associates the token with the user that initiated the sign-in flow.</span></span> <span data-ttu-id="9bd4f-126">Im folgenden wird dies als *provisorisches Token*bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-126">Below, we call this a *provisional token*.</span></span>
    * <span data-ttu-id="9bd4f-127">Im Beispiel ordnet der bot den Wert des `state` Parameters der ID des Benutzers zu, der den Anmeldeprozess initiiert hat, sodass er ihn später mit dem `state` vom Identitätsanbieter zurückgegebenen Wert abgleichen kann.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-127">In the example, the bot associates the value of the `state` parameter with the id of the user that initiated the sign-in process so it can later match it with the `state` value returned by the identity provider.</span></span> <span data-ttu-id="9bd4f-128">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L70-L99))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-128">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L70-L99))</span></span>
    * <span data-ttu-id="9bd4f-129">**Wichtig**: der bot speichert das Token, das vom Identitätsanbieter empfangen wird, und ordnet ihn einem bestimmten Benutzer zu, wird jedoch als "ausstehende Validierung" gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-129">**IMPORTANT**: The bot stores the token it receives from the identity provider and associates it with a specific user, but it is marked as "pending validation".</span></span> <span data-ttu-id="9bd4f-130">Das vorläufige Token kann noch nicht verwendet werden: Es muss weiter validiert werden:</span><span class="sxs-lookup"><span data-stu-id="9bd4f-130">The provisional token cannot be used yet: it must be further validated:</span></span> 
      1. <span data-ttu-id="9bd4f-131">**Überprüfen Sie, was vom Identitätsanbieter empfangen wurde.**</span><span class="sxs-lookup"><span data-stu-id="9bd4f-131">**Validate what's received from the identity provider.**</span></span> <span data-ttu-id="9bd4f-132">Der Wert des `state` Parameters muss gegenüber dem, was zuvor gespeichert wurde, bestätigt werden.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-132">The value of the `state` parameter must be confirmed against what was saved earlier.</span></span> 
      1. <span data-ttu-id="9bd4f-133">**Überprüfen Sie, was von Microsoft Teams empfangen wurde.**</span><span class="sxs-lookup"><span data-stu-id="9bd4f-133">**Validate what's received from Teams.**</span></span> <span data-ttu-id="9bd4f-134">Es wird eine [zweistufige Authentifizierungs](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) Überprüfung durchgeführt, um sicherzustellen, dass der Benutzer, der den bot mit dem Identitätsanbieter autorisiert hat, derselbe Benutzer ist, der mit dem bot chattet.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-134">A [two-step authentication](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) validation is performed to ensure that the user who authorized the bot with the identity provider is the same user who is chatting with the bot.</span></span> <span data-ttu-id="9bd4f-135">Dies schützt vor [man-in-the-Middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) -und [Phishing](https://en.wikipedia.org/wiki/Phishing) -Angriffen.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-135">This guards against [man-in-the-middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) and [phishing](https://en.wikipedia.org/wiki/Phishing) attacks.</span></span> <span data-ttu-id="9bd4f-136">Der Bot generiert einen Überprüfungscode und speichert ihn, der dem Benutzer zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-136">The bot generates a verification code and stores it, associated with the user.</span></span> <span data-ttu-id="9bd4f-137">Der Überprüfungscode wird automatisch von Microsoft Teams gesendet, wie weiter unten in den Schritten 9 und 10 beschrieben.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-137">The verification code is sent automatically by Teams as described below in steps 9 and 10.</span></span> <span data-ttu-id="9bd4f-138">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L100-L113))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-138">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/AuthBot.ts#L100-L113))</span></span>
9. <span data-ttu-id="9bd4f-139">Der OAuth-Rückruf rendert eine Seite, `notifySuccess("<verification code>")`die ruft.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-139">The OAuth callback renders a page that calls `notifySuccess("<verification code>")`.</span></span> <span data-ttu-id="9bd4f-140">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/master/src/views/oauth-callback-success.hbs))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-140">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/master/src/views/oauth-callback-success.hbs))</span></span>
10. <span data-ttu-id="9bd4f-141">Teams schließt das Popup und sendet das `<verification code>` an den `notifySuccess()` bot zurückgesendete.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-141">Teams closes the popup and sends the `<verification code>` sent to `notifySuccess()` back to the bot.</span></span> <span data-ttu-id="9bd4f-142">Der bot erhält eine [Invoke](/bot-framework/dotnet/bot-builder-dotnet-activities#invoke) -Nachricht `name = signin/verifyState`mit.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-142">The bot receives an [invoke](/bot-framework/dotnet/bot-builder-dotnet-activities#invoke) message with `name = signin/verifyState`.</span></span>
11. <span data-ttu-id="9bd4f-143">Der bot überprüft den eingehenden Verifizierungscode mit dem Bestätigungscode, der mit dem provisorischen Token des Benutzers gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-143">The bot checks the incoming verification code against the verification code stored with the user's provisional token.</span></span> <span data-ttu-id="9bd4f-144">([Code anzeigen](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L127-L140))</span><span class="sxs-lookup"><span data-stu-id="9bd4f-144">([View code](https://github.com/OfficeDev/microsoft-teams-sample-auth-node/blob/469952a26d618dbf884a3be53c7d921cc580b1e2/src/dialogs/BaseIdentityDialog.ts#L127-L140))</span></span>
12. <span data-ttu-id="9bd4f-145">Wenn Sie übereinstimmen, markiert der bot das Token als validiert und kann verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-145">If they match, the bot marks the token as validated and ready for use.</span></span> <span data-ttu-id="9bd4f-146">Andernfalls schlägt der Authentifizierungs Fluss fehl, und der bot löscht das provisorische Token.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-146">Otherwise, the auth flow fails, and the bot deletes the provisional token.</span></span>

> [!Note]
> <span data-ttu-id="9bd4f-147">Wenn bei der Authentifizierung auf mobilen Geräten Probleme auftreten, stellen Sie sicher, dass Ihr JavaScript-SDK auf Version 1.4.1 oder höher aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="9bd4f-147">If you experience issues with authentication on mobile, ensure your Javascript SDK is update to version 1.4.1 or later.</span></span>

## <a name="samples"></a><span data-ttu-id="9bd4f-148">Beispiele</span><span class="sxs-lookup"><span data-stu-id="9bd4f-148">Samples</span></span>

<span data-ttu-id="9bd4f-149">Beispielcode zum Anzeigen des bot-Authentifizierungsprozesses finden Sie unter:</span><span class="sxs-lookup"><span data-stu-id="9bd4f-149">For sample code showing the bot authentication process see:</span></span>

* [<span data-ttu-id="9bd4f-150">Beispiel für Microsoft Teams-bot-Authentifizierung (Knoten)</span><span class="sxs-lookup"><span data-stu-id="9bd4f-150">Microsoft Teams bot authentication sample (Node)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-auth-node)

## <a name="more-details"></a><span data-ttu-id="9bd4f-151">Weitere Details</span><span class="sxs-lookup"><span data-stu-id="9bd4f-151">More details</span></span>

<span data-ttu-id="9bd4f-152">Ausführliche Exemplarische Vorgehensweisen zur Implementierung von bot-Authentifizierung für Azure Active Directory finden Sie unter:</span><span class="sxs-lookup"><span data-stu-id="9bd4f-152">For detailed implementation walkthroughs for bot authentication targeting Azure Active Directory see:</span></span>

* [<span data-ttu-id="9bd4f-153">Authentifizieren eines Benutzers in einem Microsoft Teams-bot</span><span class="sxs-lookup"><span data-stu-id="9bd4f-153">Authenticate a user in a Microsoft Teams bot</span></span>](~/resources/bot-v3/bot-authentication/auth-bot-AAD.md)
